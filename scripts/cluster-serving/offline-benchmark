#!/bin/bash

chmod a+x ./*
fuser -k 6006/tcp
rm cluster-serving.log
rm -rf TensorboardEventLogs
rm running &&
echo "old logs removed"

if [ -z "${ANALYTICS_ZOO_HOME}" ]; then
    echo "You must set ANALYTICS_ZOO_HOME variable to run auto benchmark"
    exit 1
fi
wget https://raw.githubusercontent.com/intel-analytics/analytics-zoo/master/pyzoo/test/zoo/resources/serving_quick_start/cat1.jpeg
source ${ANALYTICS_ZOO_HOME}/bin/analytics-zoo-env.sh
python3 ./cluster-serving-init &&
echo "initialized env" &&
./cluster-serving-start &
sleep 10

python3 ./cluster-serving-enqueue-test &

./cluster-serving-stop
sleep 10
./cluster-serving-start &
rm cat1.jpeg



sleep 120
./cluster-serving-stop

echo "Benchmark test end, please check at cluster-serving.log"